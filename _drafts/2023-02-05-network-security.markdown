---
layout: post
title: "计算机网络——网络安全"
---

本章中我们将着重考察网络上运行的各式各样的程序如何保护自己的安全。
和任何成熟的密码学文章一样，我们使用Alice和Bob来表示两个希望进行安全通信的个体，用Trudy（来自Intruder，即入侵者）来表示试图迫害他们的人。

## 什么是网络安全

**安全通信**（Secure communication）具有以下特性：
1. *机密性*（Confidentiality）：仅有发送方和接收方可以理解传输报文的内容，这要求报文在一定程度上进行**加密**（encrypted）。
2. *报文完整性*（Message integrity）：接收方可以验证报文在传输过程中未受改变。
3. *端点鉴别*（End-point authentication）：发送方和接收方都可以确认通信过程中所涉及的另一方的身份。
4. *运行安全性*（Operational security）：保护网络系统在运行时的安全，反制对机构网络的攻击。

相对地，入侵者总是可以执行以下行为：
1. *窃听*：监听并记录任何信道上传输的任何报文，包括控制和数据报文；
2. *修改*、*插入*或*删除*任何报文或报文的任何内容。

这些行为让入侵者有能力窃听通信内容，包括口令和数据，假冒另一个实体，劫持会话或是系统过载以拒绝合法请求（称为拒绝服务攻击，DoS）。

密码学是网络安全的基石。

## 密码学概观

和基于语言学的传统密码学不同，现代密码学（Cryptography）基于近三十年来统计学、信息论、离散数学和抽象代数等的广泛发展。
尽管密码学通常只是有关数据的加密与解密，其与检验报文完整性、端点鉴别和不可否认性紧密相关。

我们称报文的最初形式为**明文**（plaintext，cleartext）。
发送方（Alice）使用**加密算法**（Encryption algorithm）加密其报文，然后产生**密文**（Ciphertext）。
该密文原则上对任何入侵者都是难以理解的（数学上讲，即对入侵者不存在计算明文的多项式算法）。

作为加密算法的输入，Alice通常需要提供一个**密钥**（Key），记为$K\_A$。
我们用$m$来表示明文，而$K\_A(m)$表示加密后的密文。
如何使用密钥进行加密则取决于语境中的加密算法。

接收方（Bob）也必须为**解密算法**（Decryption algorithm）提供一个密钥作为输入，记为$K\_B$。
我们希望解密得出的内容和明文相同，即$m = K\_B(K\_A(m))$。

如果接收方和发送方的密钥相同，那么这种加密系统称为**对称密钥系统**（Symmetric key system）。
如果发送方使用一个密钥进行加密，接收方使用另一个密钥进行解密，那么这种加密系统就是非对称的。
在这种情况下，加密的密钥通常是公开的，称为**公钥**（Public key），而解密的密钥是保密的，称为**私钥**（Private key）。
这种加密系统也称**公开密钥系统**（Public key system）。

值得注意的是，公用的加密技术都是*已知*的，人人都可以使用。
这是因为密码学的知名原理：**柯克霍夫原则**（Kerckhoffs's principle），即密码系统应该就算被所有人知道系统的运作步骤，仍然是安全的。
换句话说，即使密码系统的任何细节已为人悉知，只要密匙未泄漏，它也应是安全的，系统的安全应当依靠密钥的保密性，而非算法的保密性。
当然，对于军用算法，即使密码系统也是不公开的。

这里需要注意区分*密钥*（key）、*口令*（password）和*密码*。
密钥是加密或解密算法的输入，而口令通常是鉴别用户的身份所用。
日常生活中广泛接触的银行卡密码、计算机登录密码或电子邮箱的密码实际上都是口令。
有些加密系统会使用用户的口令来生成密钥，这种加密方法称为*基于口令的加密*（Password based encryption），在[RFC 8018](https://www.rfc-editor.org/rfc/rfc8018)中就描述了这些方法。
密码则是一个口语上的说法，尽管密码学以其命名，它并不具有严格的定义。

### 攻击者模型

入侵者希望攻击密码系统，以获得任何密文对应的明文甚至密钥。
我们在考虑侵入者对密码系统的攻击能力时，对其能力作以下分类：

1. *唯密文攻击*（ciphertext-only attack）：攻击者只能够获得密文，不知道任何有关明文的信息。
   - 唯密文攻击的一个特殊的子类型为暴力攻击，即穷举所有可能的密钥。如果攻击者具有*无限*的资源，那么只有具有*信息论安全性*（Information-theoretic security）的加密方法可以抵抗穷举攻击。目前最知名的信息论安全算法为*一次一密加密*（One-time pad）
2. *已知明文攻击*（known-plaintext attack）：攻击者可以获得至少一部分明文，并且知道它们对应的密文。古典密码很难对抗这种攻击。
3. *选择明文攻击*（chosen-plaintext attack）：攻击者可以获得任何自选明文的密文。
4. *选择密文攻击*（chosen-ciphertext attack）：攻击者可以获得任何自选密文的明文。这种情况下，攻击者更关心密钥而非明文。

### 对称密码体制

没有一篇介绍密码学的文章不是从**凯撒密码**开始的。
凯撒密码即位移密码，这种密码把每个字母依次用字母表后的几个字母替代。
假设我们取后三个字符，那么`a`变成`d`，`z`变成`c`。
在这种密码中，密钥就是后移字母的个数，此处为3。
显然，这种密码非常容易攻破，因为密钥的有效值最多只有25个。

凯撒密码的一种改进是**单码代替密码**（Monoalphabetic cipher）。
这种密码建立一个从字母表到字母表的双射作为密码。
加密时使用映射把原文的每个字符替代成密文，解密时使用逆映射即可。
这种密码的密钥就是这个双射，其有$26! \approx 10^{26}$种可能。

虽然这种方法足以对抗现代个人计算机的穷举攻击，但简单的统计分析就可以使其败下阵来。
以英语为例，大量语料表明，英语中字母`e`和`t`的出现频率最高。
如果能够获得足量的密文，那么使用概率分析就可以查出这个双射，因此这种密码难以对抗唯密文攻击。
显然，这种密码也不能对抗已知明文攻击，只要能够确定几个字母的对应关系，穷举所需的时间就能大大减小。

针对这种缺点，人们发明了**多码代替密码**（Polyalphabetic cipher）。
这种密码轮流使用多个单码代替密码来进行加密。
我们设两个不同的单码代替密码$C\_1$、$C\_2$，那么轮流使用$C\_1, C\_2, C\_1, C\_2, \dots$就形成了一个多码代替密码。
这种密码的密钥包括每个单码代替密码的映射表和使用这些密码的次序。

#### 块密码

对称加密技术按照处理数据的单位可以分为两类：**块密码**（Block cipher）和**流密码**（Stream cipher）。
不正式地说，块密码把数据分成固定大小的块，然后对每一块进行加密；
而流密码则对数据的每一比特进行加密，这通常是通过按位异或做到的。
流密码主要用于各种无线数据的加密，本节中我们将主要考虑块密码。

块密码首先把输入数据分成固定大小的块，然后使用一个双射将明文块转化成密文块。
实现这种映射的最简单形式就是构造一个数组，然后直接用明文块作为下标进行索引。
然而，当块增大时，这个数组就会以指数速度膨胀，因此即使对比较小的块（比如64比特），这种表也是不现实的。

取而代之的是，块密码通常使用函数模拟这张表。
常见的情况是首先先把较大的块分成几个较小的块，然后为这几个块依次选用不同的映射表进行加密，最后还要使用一个置乱函数打乱这些块之间的顺序。
如果将64比特分为八个八比特大小的分块，那么所有表加起来只需要$8 \times 2^8 = 2048$个表项，远远小于$2^{64}$个。
这种同时使用代替和置乱的密码系统称为**代换-置换网络**（Substitution-Permutation Network，SPN）

现有的比较流行的块密码，如*高级加密标准*（Advanced Encryption Standard，AES），就使用SPN的一个变种。
这种密码系统使用密钥来决定代替表和置换函数。
AES的分块长达128比特，而其密钥长为128、192或256比特。

